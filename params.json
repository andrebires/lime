{"name":"LIME Protocol","tagline":"Lime protocol specification","body":"# Home - LIME Protocol\r\n\r\n>This specification is a **work in progress** and is subject to change without notice.\r\n\r\n### What is it?\r\n\r\n**LIME Protocol** (acronym for _Lightweight Messaging Protocol_) is a JSON based protocol for messaging, inspired by the XMPP protocol. It aims to be simple but extensible, with little verbosity but yet providing good readability.\r\n\r\n### And why not just use XMPP?\r\n\r\nXMPP is a protocol widely used for real-time communication but is complex due to the number of features and extensions that it implements. Just take a look at its [specification][1] to understand that XMPP goes far beyond what LIME proposes.\r\n\r\nThis protocol defines only a basic message structure and makes use of the MIME content type declarations to remain extensible, but is not mean to cover all the scenarios that XMPP supports.\r\n\r\n### Concepts\r\n\r\nThe basic idea of the protocol is the exchange of JSON documents between elements in a network. These documents are called **envelopes** and the elements **nodes**.\r\n\r\nThe protocol defines four types of envelopes:\r\n\r\n* **Message** - Provides the transport of a content between nodes in a network.\r\n* **Notification** - Notify events related to a message.\r\n* **Command** - Allows the manipulation of node resources, like server session parameters or information related to network nodes.\r\n* **Session** - Allows the configuration and establishment of the communication channel between nodes.\r\n\r\nThe nodes communicate with each other over persistent connections, like TCP or Websockets. The protocol is asynchronous, so there's no guarantee of delivery order of the envelopes, except during the session negotiation, where only session envelopes are allowed.\r\n\r\nEvery connected node must have an identity, presented in the _name@domain_ format, as defined by the [RFC 2822, section 3.4.1][2]. The domain name should be a valid domain (i.e. can be resolved by a DNS server) and the name a valid user account identifier in the domain. The identity is authenticated by the server during the establishment of the session.\r\n\r\nIn addition to the identity, the connected node can suggest a name to the particular connection using a identifier called _instance_. This identifier should appears after the identity, separated by a slash (/) symbol, during the session authentication process. One identity can have more than one active connection in a domain so the _instance_ should be used to differentiate these connections. Usually is used the name of the device (John-Cellphone, John-PC) but can be any valid string. If not provided, the server will set a default value.\r\n\r\nTherewith, the complete format of a node identifier is _name@domain/instance_, similar to the [XMPP's Jabber ID][3] (the difference is that the identifier located after the slash is called _instance_ instead of _resource_).\r\n\r\nDuring a connection, there's a **server** which is the node that received the connection and the **client**, the node which started it. The only difference between these roles is related to the session state management, where the server has full control of it. Besides that, they share the same set of functionality. During the session establishment, the server provides an session id, its own node identifier and the client node identifier. It can optionally authenticate the client using an authentication scheme or provide an arbitrary node identifier without asking any information of the client.\r\n\r\nAlthough both parties of a session knows each other's node identifier, they can receive and send envelopes with distinct node information of the remote party. This means that a node can act as intermediate to be a envelopes switcher for nodes that are not directly connected. But it must be trusted by both sender and destination nodes for that.\r\n\r\nFor instance, in a session between _client@domain/instance_ and _server@domain/instance_ the first one can receive an envelope that the sender is _someone@domain/instance_ in that session. In this case, the client must decide if it trusts the remote party to send envelopes with that node identifier. Specifically, it should look if the remote party is trusted to originate envelopes in behalf of the specified node domain. This trust should be built outside the protocol, using techniques like a DNS query to look for a SRV entry to connect in a specified domain and transport TLS authentication. You can trust a remote party if the remote certificate is a valid **domain certificate**, emitted by a trusted issuer. In the case of receiving an envelope addressed to a different node, the party that received it can forward to the destination, but only if it can directly reach it. This means that the node must have a direct connection with that node or with a node that is trusted to receive this envelope, in the same conditions that are illustrated above. And after the envelope has been forwarded, the actual envelope destination should decides if it trusts the remote party in the same way.\r\n\r\n### Envelope\r\n\r\nThe JSON documents exchanged in a LIME conversation are called envelopes. The JSON data must be compliant with the [RFC 4627][4] specification, using the [UTF-8][5] encoding.\r\n\r\nEvery envelope may contains the following properties:\r\n\r\n* **from** - Identifier of the sender node of the envelope, in the _name@domain/instance_ format. If a node receives an envelope without this value, it means that the envelope was originated by the remote party.\r\n* **to** - Identifier of the destination node of the envelope, in the same format of the sender. If a node receives an envelope without this value, it means that the envelope is addressed to itself.\r\n* **pp** - Acronym for _per procurationem_. Identifier of a delegate node (a node that received a permission to send on behalf of another), in the _name@domain/instance_ format. Allows a node to send an envelope on behalf of another identity.\r\n* **id** - Unique identifier of the envelope, in the [UUID][6] format. The purpose of using a 128-bit identifier is minimize the risk of a collision, since the protocol allows interconnections between networks in different domains, each one with a large number of connected nodes.\r\n* **metadata** - Allows the transport of generic information, in the \"name\": \"value\" format. This property is optional for all envelopes. Any value set in this property should not change the behavior of the server.\r\n\r\n### Message\r\n\r\nA message provides the transport of a content between nodes in a network.\r\n\r\nJSON Schema:\r\n\r\n    {\r\n        \"$schema\": \"http://json-schema.org/draft-04/schema#\",\r\n        \"title\": \"message\",\r\n        \"type\": \"object\",\r\n        \"properties\": {\r\n            \"from\": {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"^(?:([^\"&'/:@]{1,1023})@)?([^/@]{1,1023})(?:/(.{1,1023}))?$\"\r\n            },\r\n            \"to\": {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"^(?:([^\"&'/:@]{1,1023})@)?([^/@]{1,1023})(?:/(.{1,1023}))?$\"\r\n            },\r\n            \"pp\": {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"^(?:([^\"&'/:@]{1,1023})@)?([^/@]{1,1023})(?:/(.{1,1023}))?$\"\r\n            },\r\n            \"id\" : {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"b[a-f0-9]{8}(?:-[a-f0-9]{4}){3}-[a-f0-9]{12}b\"\r\n            },\r\n            \"metadata\": {\r\n                \"type\": \"object\"\r\n            },\r\n            \"type\" : {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"^[-w]+/[-w.]+(+w+)?$\"\r\n            },\r\n            \"content\" : {\r\n                \"type\": \"object\"\r\n            },\r\n        },\r\n        \"required\": [ \"type\", \"content\" ],\r\n        \"additionalProperties\": false\r\n    }\r\n\r\nIn a message, the following constraints should apply to the envelope properties:\r\n\r\n* **id** - Optional. The sender just need provide this information in order to receive notifications related to the message. If not provided, the message is processed in the _fire-and-forget_ mode.\r\n* **from** - Optional for the sender, since the value can be determined by the server in the session. mandatory in the destination.\r\n* **to** - Mandatory for the sender, but is allowed to ommit the value of the _instance_ (the server will route the envelope according to the routing rule chosen by the destination) and/or _domain_ (the server will assume that the destination is in the same domain of the sender) properties. optional in the destination.\r\n* **pp** - Optional for the sender, when is considered the identity of the session. Is mandatory in the destination if the identity of the originator is different of the identity of the _from_ property.\r\n* **metadata** - Optional. The sender should avoid to use this property to transport any kind of content-related information, but merely data relevant to the context of the communication. Consider to define a new content type if there's a need to include more content information into the message.\r\n\r\nBesides the properties defined in the envelope, a message should contains:\r\n\r\n* **type** - [MIME][7] declaration of the content type of the message. This property is used by the destination to handle the content in the appropriate way. The MIME can be any discrete type (text, application, image, video or audio; composite types, like message or multipart, are not supported). For structured data, is recommended to use JSON subtypes (like _application/json_ or _application/vnd.specific+json_), althought is possible to send other types, like XML, provided that the unsupported characters in content are escaped, accordinally to the JSON specification. The protocol defines some [common types][8] that should be reused. If you are using a custom content type, consider [registering it][9] with IANA in order to provide interoperability.\r\n* **content** - The representation of the content. JSON content data are represented unescaped. Binary data (images, video and audio) should be represented with the Base64 encoding. The remaining data types should be represented as an escaped value.\r\n\r\nExamples\r\n\r\n_Fire-and-forget_ (no id) text message:\r\n\r\n    {\r\n        \"from\": \"skyler@breakingbad.com/bedroom\",\r\n        \"to\": \"ww@breakingbad.com\",\r\n        \"type\": \"text/plain\",\r\n        \"content\": \"Walter, are you in danger?\"\r\n    }\r\n\r\nJSON text message with metadata and notification support, omitting the destination domain:\r\n\r\n    {\r\n        \"id\": \"48600604-ce09-479c-b985-1195b196fe8e\",\r\n        \"from\": \"heisenberg@breakingbad.com/bedroom\",\r\n        \"to\": \"skyler/bedroom\",\r\n        \"type\": \"application/vnd.lime.threadedtext+json\",\r\n        \"content\": {\r\n            \"text\": \"I am the one who knocks!\",\r\n            \"thread\": 2\r\n        },\r\n        \"metadata\": {\r\n            \"senderIp\": \"192.168.0.1\"\r\n        }\r\n    }\r\n\r\nBinary text message with notification support:\r\n\r\n    {\r\n        \"id\": \"65603604-fe19-479c-c885-3195b196fe8e\",\r\n        \"to\": \"heisenberg@breakingbad.com/bedroom\",\r\n        \"type\": \"image/png\",\r\n        \"content\": \"iVBORw0KGgoAAAANSUhEUgAAACsAAAAqCAMAAAAd31JXAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MEYyQzgwNTUxQkY2MTFFMkE2NzBBRjFERkI1MEFCQjUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MEYyQzgwNTYxQkY2MTFFMkE2NzBBRjFERkI1MEFCQjUiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowRjJDODA1MzFCRjYxMUUyQTY3MEFGMURGQjUwQUJCNSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowRjJDODA1NDFCRjYxMUUyQTY3MEFGMURGQjUwQUJCNSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnkDBYEAAADAUExURcbhnr/flKbTaZPJSrPZfprMVKzWdMzlqcXinpTKS9jsvt7vyKDPX7ncieLxz9Los5vMVtTqt/j788bin6/Wec/lruby1dvswtXouJDIRfH459Lns+v13eDvy+r02+7246zUc6LRY6nTbev13t3txuXy05TJS73cj5vNV7HYe6LPYrjbh7bZhJ7OXL/fk7naiZfLUKrUb6XRZ9vtw+nz2uPw0LPXfsnipM3mq9jqvcDdk8zkqbzcjvH46P///43GP1/s3CQAAALWSURBVHjajJXpmqowDIYtlB1kVQE3wH0ddfalJ/d/V6fQAtUZz5n8kMfyJv2aJqHz5/fW+b4UdKkF/2UDf7cGOHmeB/nRv3UQ2XQHp2z/0RtQiz8fskOS+z+z6SbZrt6fCLOFRWbz4cth7f/A+kbRGRPiYmRBZYpFyGzw4eWTW9Y/rcbEkkpIZywgXdJH0zgzJtfsY7J6Ihpj+AM0hQbXyDiqYcamxv6JuHU8WfRRzHFmpAKbZ1QARwBL7KHW8eND3rJv3pCQ+hVIjDXr/9DtJGHNBsbD1NQaVkaVh9awznNhBJw9egMqQHKlWkR9stqZ9JYhZ2lYiSVJblgFQWvWbF8GpuzjMuYpUFjo8kdAJcsksedX7LHoN1qxzji5WVEdLIM2izYVm+/bHICtUeUyqJUaGevIrtSRjlGx8EmEHWVs06SVkm0OljLIEBjbE1mqw0KOAoqO2yWFvEOXsl3KjhAyTVNDSDN1ZNKSxKoqusOi17AES6XxF5S14NrMTqWhZB1x3RkRotHjS2KGv7jeLyKsSrriuIsyDQrGTn04sufsS8sqLq1IVZHrw9oqKtOnkmhdseuiX2+numUVUEW4rQbV1fRRv2B3sfPmrKZknR3eub5jqpbMvTdWD8lwVO3HS8cuPbAsZoHEyYTXWTSjWzp1RquQsnPFrta8Jnen2MWmDWL5gi4ENp8vR86m8DBtOhNs5qTowg33lmndb+ftgDQtg4SWZ+b2o2PTm11YzRZX3VZGq73x9PUUtD2/oY3MmTazXLFE4kMozIfAyOYL8WTVJbB+Hs0v+dWM6kI0Rs1FcBvJ9IRkfjOj6OyDbDijtSAJ1WWWg7V3uZ199PaMZTTsC+OH7j4dv0bLPP0+q4PQWGad8dRCNLSN9cV08LEFCO98L/w1bF+G8z6150G8ouR5cv871N1A4l2Kojh4CZzD9N/frMAPz7swDP3Jb75vd+2vAAMAIkNXL7uoiZEAAAAASUVORK5CYII=\"\r\n    }\r\n\r\n### Notification\r\n\r\nA notification transports information about events associated to a message sent in a session. Can be originated by a server or by the message destination node.\r\n\r\nJSON Schema:\r\n\r\n    {\r\n        \"$schema\": \"http://json-schema.org/draft-04/schema#\",\r\n        \"title\": \"notification\",\r\n        \"type\": \"object\",\r\n        \"properties\": {\r\n            \"from\": {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"^(?:([^\"&'/:@]{1,1023})@)?([^/@]{1,1023})(?:/(.{1,1023}))?$\"\r\n            },\r\n            \"to\": {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"^(?:([^\"&'/:@]{1,1023})@)?([^/@]{1,1023})(?:/(.{1,1023}))?$\"\r\n            },\r\n            \"pp\": {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"^(?:([^\"&'/:@]{1,1023})@)?([^/@]{1,1023})(?:/(.{1,1023}))?$\"\r\n            },\r\n            \"id\" : {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"b[a-f0-9]{8}(?:-[a-f0-9]{4}){3}-[a-f0-9]{12}b\"\r\n            },\r\n            \"metadata\": {\r\n                \"type\": \"object\"\r\n            },\r\n            \"event\" : {\r\n                \"enum\": [\r\n                    \"accepted\",\r\n                    \"validated\",\r\n                    \"authorized\",\r\n                    \"dispatched\",\r\n                    \"received\",\r\n                    \"consumed\",\r\n                    \"failed\"\r\n                ]\r\n            },\r\n            \"reason\" : {\r\n                \"type\": \"object\",\r\n                \"properties\": {\r\n                    \"code\" : {\r\n                        \"type\": \"integer\"\r\n                    },\r\n                    \"description\": {\r\n                        \"type\": \"string\"\r\n                    }\r\n                },\r\n                \"required\": [ \"code\" ]\r\n            }\r\n        },\r\n        \"required\": [ \"id\", \"event\" ],\r\n        \"additionalProperties\": false\r\n    }\r\n\r\nIn a notification, the following constraints should apply to the envelope properties:\r\n\r\n* **id** - Mandatory. The id references the related message.\r\n* **from** - Optional. If the value is not present in the destination, it means that the notification was generated by the connected node (server).\r\n* **to** - Mandatory for the sender and optional in the destination. The sender can ommit the value of the _domain_.\r\n* **pp** - Optional for the sender, when is considered the identity of the session. Is mandatory in the destination if the identity of the originator is different of the identity of the _from_ property.\r\n* **metadata** - Optional. Avoid to use this property to transport any event-related data.\r\n\r\nBesides the envelope properties, a notification may contains:\r\n\r\n* **event** - Name of the event. This property is mandatory. The possible values are:\r\n    * **accepted** - The message was received and accepted by the server.\r\n    * **validated** - The message format was validated by the server.\r\n    * **authorized** - The dispatch of the message was authorized by the server.\r\n    * **dispatched** - The message was dispatched to the destination by the server.\r\n    * **received** - The destination has received the message. This event is generated by the destination node.\r\n    * **consumed** - The destination has consumed (read or processed) the message. This event is generated by the destination node.\r\n    * **failed** - A problem occurred during the processing of the message. In this case, the _reason_ property of the notification should be present.\r\n* **reason** - In the case of a _failed_ event, this property brings more details about the problem. It contains the following properties:\r\n    * **code** - Code number of the reason. There are some protocol pre-defined codes, but may exists specific codes for each implementation of the protocol.\r\n    * **description** - Description message of the problem. This property can be omitted.\r\n\r\nExamples\r\n\r\nReceived notification sent by the destination node:\r\n\r\n    {\r\n        \"id\": \"48600604-ce09-479c-b985-1195b196fe8e\",\r\n        \"from\": \"skyler@breakingbad.com/bedroom\",\r\n        \"to\": \"heisenberg@breakingbad.com/bedroom\",\r\n        \"event\": \"received\"\r\n    }\r\n\r\nFailure notification sent by the server:\r\n\r\n    {\r\n        \"id\": \"9d0c4fea-75c7-432a-a164-c1a219bc17a8\",\r\n        \"to\": \"skyler@breakingbad.com/bedroom\",\r\n        \"event\": \"failed\",\r\n        \"reason\": {\r\n            \"code\": 42,\r\n            \"description\": \"The message destination was not found\"\r\n        }\r\n    }\r\n\r\n### Command\r\n\r\nAllows the manipulation of node resources, like server session parameters or information related to the network nodes.\r\n\r\nJSON Schema:\r\n\r\n    {\r\n        \"$schema\": \"http://json-schema.org/draft-04/schema#\",\r\n        \"title\": \"command\",\r\n        \"type\": \"object\",\r\n        \"properties\": {\r\n            \"from\": {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"^(?:([^\"&'/:@]{1,1023})@)?([^/@]{1,1023})(?:/(.{1,1023}))?$\"\r\n            },\r\n            \"to\": {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"^(?:([^\"&'/:@]{1,1023})@)?([^/@]{1,1023})(?:/(.{1,1023}))?$\"\r\n            },\r\n            \"pp\": {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"^(?:([^\"&'/:@]{1,1023})@)?([^/@]{1,1023})$\"\r\n            },\r\n            \"id\" : {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"b[a-f0-9]{8}(?:-[a-f0-9]{4}){3}-[a-f0-9]{12}b\"\r\n            },\r\n            \"metadata\": {\r\n                \"type\": \"object\"\r\n            },\r\n            \"method\" : {\r\n                \"enum\": [\r\n                    \"get\",\r\n                    \"set\",\r\n                    \"delete\",\r\n                    \"observe\"\r\n                ]\r\n            },\r\n            \"uri\" : {\r\n                \"title\": \"limeUri\",\r\n                \"type\": \"string\",\r\n                \"pattern\": \"^((lime://)(w.?-?)+@?(w.?-?@?)+)?(/(w.?-?@?)+)+(?{1}((w+=w+)&?)+)?$\"\r\n            },\r\n            \"type\" : {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"^[-w]+/((json)|([-w.]+(+json)))$\"\r\n            },\r\n            \"resource\" : {\r\n                \"type\": \"object\"\r\n            },\r\n            \"status\": {\r\n                \"enum\": [\r\n                    \"success\",\r\n                    \"failure\"\r\n                ]\r\n            },\r\n            \"reason\" : {\r\n                \"type\": \"object\",\r\n                \"properties\": {\r\n                    \"code\" : {\r\n                        \"type\": \"integer\"\r\n                    },\r\n                    \"description\": {\r\n                        \"type\": \"string\"\r\n                    }\r\n                },\r\n                \"required\": [ \"code\" ]\r\n            }\r\n        },\r\n        \"required\": [ \"id\", \"method\" ],\r\n        \"additionalProperties\": false\r\n    }\r\n\r\nIn a command, the following constraints should apply to the envelope properties:\r\n\r\n* **id** - Mandatory, except for the _observe_ method. Must be provided during the request and the same value should be in the related response command.\r\n* **from** - Optional. If the value is not present in the destination, it means that the notification was generated by the connected node (server).\r\n* **to** - Optional. If the value is left empty in the request, the command will be processed by the connected node (server).\r\n* **pp** - Optional. This property is useful to get resources in the server owned by different identities, like presence and account information. The value should be defined if the resource of an _observe_ method command is owned by a different identity than the destination.\r\n* **metadata** - Optional. Avoid to use this property to transport any command-related data, like extra parameters.\r\n\r\nBesides the envelope properties, a command may contains:\r\n\r\n* **method** - Method for the manipulation of the resource. This property is mandatory. The possible values are:\r\n    * **get** - Gets an existing value of the resource.\r\n    * **set** - Sets or updates a for the resource.\r\n    * **delete** - Deletes a value of the resource or the resource itself.\r\n    * **observe** - Notify the destination about a change in the resource value of the sender. Commands with this method are one-way and the destination should not send a response for it. Because of that, these commands may not have an _id_.\r\n* **uri** - The uniform resource identifier ([RFC 3986][10]). This property is mandatory in command requests and can be ommited in responses. It must be present in _observe_ commands. The supported scheme is _lime_, and the authority must be always the identity of the resource owner. In command requests, this identity is always the same of the identity of _from_ envelope property. Since the base URI is always the same for a specific identity (_lime://user@domain_), the URI can be represented as a fragment, like _/groups_, instead of _lime://user@domain/groups_. The URI may als contains a query string for filtering.\r\n* **type** - MIME type of the resource. Like the messages, the protocol defines some [common resource types][11], but may exists specific resources to the implementation. This property should be present always when the value of _resource_ property is defined.\r\n* **resource** - JSON representation of the resource. It must be present in commands with the methods _set_ and _observe_ and may be present in the method _delete_. In a command response, must be present in successfully processed command with the method _get_.\r\n\r\nIn addition of the above, the command response may contains the following properties:\r\n\r\n* **status** - Result status of the command processing. Mandatory in response commands. The valid values are:\r\n    * **success** - The command was processed successfully. In cases of command of method _get_, the property _resource_ of the response should have a value.\r\n    * **failure** - A problem occurred while processing the command. In this case, the property _reason_ of the response should have a value.\r\n* **reason** - If the command was not successfully processed, this property should provide more details about the problem. It contains the following properties:\r\n    * **code** - Code number of the reason. There are some protocol pre-defined codes, but may exists specific codes for each implementation of the protocol.\r\n    * **description** - Description message of the problem. This property can be omitted.\r\n\r\nExamples\r\n\r\nSetting the presence:\r\n\r\n    C:\r\n\r\n    {\r\n        \"id\": \"9cbe5fe1-b6b2-4afe-ab12-0675aa139f36\",\r\n        \"from\": \"jesse@breakingbad.com/home\",\r\n        \"method\": \"set\",\r\n        \"uri\": \"/presence\",\r\n        \"type\": \"application/vnd.lime.presence+json\",\r\n        \"resource\": {\r\n            \"status\": \"available\",\r\n            \"message\": \"Yo 148, 3-to-the-3-to-the-6-to-the-9. Representin' the ABQ. What up, biatch?\"\r\n        }\r\n    }\r\n\r\n    S:\r\n\r\n    {\r\n        \"id\": \"9cbe5fe1-b6b2-4afe-ab12-0675aa139f36\",\r\n        \"from\": \"server@breakingbad.com\",\r\n        \"method\": \"set\",\r\n        \"status\": \"success\"\r\n    }\r\n\r\nGetting the roster with a filter:\r\n\r\n    C:\r\n\r\n    {\r\n        \"id\": \"b784a7d2-59d7-45de-a1eb-8c50a0f5edb8\",\r\n        \"from\": \"jesse@breakingbad.com/home\",\r\n        \"method\": \"get\",\r\n        \"uri\": \"lime://jesse@breakingbad.com/contacts?sharePresence=true&take=3\"\r\n    }\r\n\r\n    S:\r\n\r\n    {\r\n        \"id\": \"b784a7d2-59d7-45de-a1eb-8c50a0f5edb8\",\r\n        \"from\": \"server@breakingbad.com\",\r\n        \"method\": \"get\",\r\n        \"status\": \"success\",\r\n        \"type\": \"application/vnd.lime.collection+json\",\r\n        \"resource\": {\r\n            \"total\": \"4\",\r\n            \"itemType\": \"application/vnd.lime.contact+json\",\r\n            \"items\": [\r\n                {\r\n                    \"identity\": \"skinnypete@breakingbad.com\"\r\n                },\r\n                {\r\n                    \"identity\": \"badger@breakingbad.com\"\r\n                },\r\n                {\r\n                    \"identity\": \"combo@breakingbad.com\"\r\n                }\r\n            ]\r\n        }\r\n    }\r\n\r\nTrying without success to get another user account information:\r\n\r\n    C:\r\n\r\n    {\r\n        \"id\": \"5c95e87f-7f0c-4cc3-b55b-99056d9f288d\",\r\n        \"from\": \"gusfring@breakingbad.com\",\r\n        \"pp\": \"saul@breakingbad.com\",\r\n        \"method\": \"get\",\r\n        \"uri\": \"lime://gusfring@breakingbad.com/account\"\r\n    }\r\n\r\n    S:\r\n\r\n    {\r\n        \"id\": \"5c95e87f-7f0c-4cc3-b55b-99056d9f288d\",\r\n        \"from\": \"server@breakingbad.com\",\r\n        \"method\": \"get\",\r\n        \"status\": \"failure\",\r\n        \"reason\": {\r\n            \"code\": 56,\r\n            \"description\": \"The request account is not sharing information with current session identity\"\r\n        }\r\n    }\r\n\r\n### Session\r\n\r\nAllows the configuration and establishment of the communication channel between nodes. Parameters like authentication, cryptography and compression are set through the session envelope.\r\n\r\nJSON Schema:\r\n\r\n    {\r\n        \"$schema\": \"http://json-schema.org/draft-04/schema#\",\r\n        \"title\": \"session\",\r\n        \"type\": \"object\",\r\n        \"properties\": {\r\n            \"from\": {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"^(?:([^\"&'/:@]{1,1023})@)?([^/@]{1,1023})(?:/(.{1,1023}))?$\"\r\n            },\r\n            \"to\": {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"^(?:([^\"&'/:@]{1,1023})@)?([^/@]{1,1023})(?:/(.{1,1023}))?$\"\r\n            },\r\n            \"id\" : {\r\n                \"type\": \"string\",\r\n                \"pattern\": \"b[a-f0-9]{8}(?:-[a-f0-9]{4}){3}-[a-f0-9]{12}b\"\r\n            },\r\n            \"metadata\": {\r\n                \"type\": \"object\"\r\n            },\r\n            \"state\" : {\r\n                \"enum\": [\r\n                    \"new\",\r\n                    \"negotiating\",\r\n                    \"authenticating\",\r\n                    \"established\",\r\n                    \"finishing\",\r\n                    \"finished\",\r\n                    \"failed\"\r\n                ]\r\n            },\r\n            \"encryptionOptions\": {\r\n                \"type\": \"array\",\r\n                \"minItems\": 1,\r\n                \"items\": { \"type\": \"string\" },\r\n                \"uniqueItems\": true\r\n            },\r\n            \"encryption\": {\r\n                \"type\": \"string\"\r\n            },\r\n            \"compressionOptions\": {\r\n                \"type\": \"array\",\r\n                \"minItems\": 1,\r\n                \"items\": { \"type\": \"string\" },\r\n                \"uniqueItems\": true\r\n            },\r\n            \"compression\": {\r\n                \"type\": \"string\"\r\n            },\r\n            \"schemeOptions\": {\r\n                \"type\": \"array\",\r\n                \"minItems\": 1,\r\n                \"items\": { \"type\": \"string\" },\r\n                \"uniqueItems\": true\r\n            },\r\n            \"scheme\": {\r\n                \"type\": \"string\"\r\n            },\r\n            \"authentication\": {\r\n                \"type\": \"object\"\r\n            },\r\n            \"reason\" : {\r\n                \"type\": \"object\",\r\n                \"properties\": {\r\n                    \"code\" : {\r\n                        \"type\": \"integer\"\r\n                    },\r\n                    \"description\": {\r\n                        \"type\": \"string\"\r\n                    }\r\n                },\r\n                \"required\": [ \"code\" ]\r\n            }\r\n        },\r\n        \"required\": [ \"state\" ],\r\n        \"additionalProperties\": false\r\n    }\r\n\r\nIn a session, the following constraints should apply to the envelope properties:\r\n\r\n* **id** - Mandatory, except in the first request sent by the client (_new_ state). This value is generated by the server in the first session envelope sent to the client.\r\n* **from** - Mandatory for the client during the session authentication. Otherwise, is optional. The client may ommit the _instance_ value. In this case, the server will define a default instance value.\r\n* **to** - Optional.\r\n* **pp** - Not applicable.\r\n* **metadata** - The server should ignore any value set in this property by the client but it can use this property to send statistics about itself (serverVersion, lastConnectionDate, and so) to the client.\r\n\r\nBesides envelope properties, a session may contains:\r\n\r\n* **state** - Informs or changes the state of a session. Only the server can change the session state, but the client can request the state transition. The valid values are:\r\n    * **new** - The session is new and doesn't exists an established context. It is sent by a client node to start a session with a server.\r\n    * **negotiating** - The server and the client are negotiating the session options, like cryptography and compression. The server sends to the client the options (if available) and the client chooses the desired options. If there's no options (for instance, if the connection is already encrypted or the transport protocol doesn't support these options), the server should skip the negotiation.\r\n    * **authenticating** - The session is being authenticated. The server sends to the client the available authentication schemes list and the client must choose one and send the specific authentication data. The authentication can occurs in multiple roundtrips, according to the selected schema.\r\n    * **established** - The session is active and is possible to send and receive messages and commands. The server sends this state after the session was authenticated.\r\n    * **finishing** - The client node is requesting to the server to finish the session.\r\n    * **finished** - The session was finished by the server.\r\n    * **failed** - A problem occurred while the session was established, under negotiation or authentication and it was closed by the server. In this case, the property _reason_ must be present to provide more details about the problem.\r\n* **encryptionOptions** - Encryption options provided by the server during the session negotiation. Some of the valid values (not limited to) are:\r\n    * **none** - The session will be not encrypted.\r\n    * **tls** - The session will be encrypted by TLS. This options is required for transport authentication in TCP transport connections.\r\n* **encryption** - The encryption option selected for the session. This property is provided by the client in the negotiation and by the server in the confirmation after that.\r\n* **compressionOptions** - Compression options provided by the server during the session negotiation. Some of the valid values (not limited to) are:\r\n    * **none** - The session will not be compressed.\r\n    * **gzip** - The session will use the GZip algorithm for compression.\r\n* **compression** - The compression option selected for the session. This property is provided by the client in the negotiation and by the server in the confirmation after that.\r\n* **schemeOptions** - List of available authentication schemas for session authentication provided by the server. Some of the valid values (not limited to) are:\r\n    * **guest** - The server doesn't requires a client credential, and provides a temporary identity to the node. Some restriction may apply to guest sessions, like the inability of sending some commands or other nodes may want to block messages originated by guest identities.\r\n    * **plain** - User and password authentication.\r\n    * **transport** - The authentication is made in the transport level. For the TCP transport, this indicates a TLS/SSL client authentication, which requires a certificate from the client. This certificate should be already presented during the session negotiation state, after the confirmation of the encryption options, in the TLS handshake.\r\n* **scheme** - The authentication scheme option selected for the session. This property must be present if the property authentication is defined.\r\n* **authentication** - Authentication data, related to the selected schema. Information like password sent by the client or roundtrip data sent by the server.\r\n* **reason** - In cases where the client receives a session with _failed_ state, this property should provide more details about the problem. It contains the following properties:\r\n    * **code** - Code number of the reason. There are some protocol pre-defined codes, but may exists specific codes for each implementation of the protocol.\r\n    * **description** - Description message of the problem. This property can be omitted.\r\n\r\nExamples\r\n\r\nEstablishment and closing of a session with negotiation and authentication:\r\n\r\n    C:\r\n\r\n    {\r\n        \"state\": \"new\"\r\n    }\r\n\r\n    S:\r\n\r\n    {\r\n        \"id\": \"d35ad2be-9aa9-4825-9096-d6332655ed1d\",\r\n        \"from\": \"server@breakingbad.com/server1\",\r\n        \"state\": \"negotiating\",\r\n        \"encryptionOptions\": [ \"none\", \"tls\" ],\r\n        \"compressionOptions\": [ \"none\", \"gzip\" ]\r\n\r\n    }\r\n\r\n    C:\r\n\r\n    {\r\n        \"id\": \"d35ad2be-9aa9-4825-9096-d6332655ed1d\",\r\n        \"state\": \"negotiating\",\r\n        \"encryption\": \"tls\",\r\n        \"compression\": \"none\"\r\n    }\r\n\r\n    S:\r\n\r\n    {\r\n        \"id\": \"d35ad2be-9aa9-4825-9096-d6332655ed1d\",\r\n        \"from\": \"server@breakingbad.com/server1\",\r\n        \"state\": \"negotiating\",\r\n        \"encryption\": \"tls\",\r\n        \"compression\": \"none\"\r\n    }\r\n\r\n    S:\r\n\r\n    {\r\n        \"id\": \"d35ad2be-9aa9-4825-9096-d6332655ed1d\",\r\n        \"from\": \"server@breakingbad.com/server1\",\r\n        \"state\": \"authenticating\",\r\n        \"schemeOptions\": [ \"guest\", \"plain\" ]\r\n    }\r\n\r\n    C:\r\n\r\n    {\r\n        \"id\": \"d35ad2be-9aa9-4825-9096-d6332655ed1d\",\r\n        \"from\": \"gale@breakingbad.com/lab\",\r\n        \"state\": \"authenticating\",\r\n        \"scheme\": \"plain\",\r\n        \"authentication\": {\r\n            \"password\": \"aWxvdmV1d3c=\"\r\n        }\r\n    }\r\n\r\n    S:\r\n\r\n    {\r\n        \"id\": \"d35ad2be-9aa9-4825-9096-d6332655ed1d\",\r\n        \"from\": \"server@breakingbad.com\",\r\n        \"to\": \"gale@breakingbad.com/lab\",\r\n        \"state\": \"established\"\r\n    }\r\n\r\n    C:\r\n\r\n    {\r\n        \"id\": \"d35ad2be-9aa9-4825-9096-d6332655ed1d\",\r\n        \"state\": \"finishing\"\r\n    }\r\n\r\n    S:\r\n\r\n    {\r\n        \"id\": \"d35ad2be-9aa9-4825-9096-d6332655ed1d\",\r\n        \"from\": \"server@breakingbad.com/server1\",\r\n        \"state\": \"finished\"\r\n    }\r\n\r\n[1]: http://xmpp.org/xmpp-protocols/xmpp-core/\r\n[2]: http://tools.ietf.org/html/rfc2822#section-3.4.1\r\n[3]: http://xmpp.org/rfcs/rfc3920.html#rfc.section.3\r\n[4]: http://tools.ietf.org/html/rfc4627\r\n[5]: http://tools.ietf.org/html/rfc3629\r\n[6]: http://www.ietf.org/rfc/rfc4122.txt\r\n[7]: http://tools.ietf.org/html/rfc2045\r\n[8]: /contenttypes\r\n[9]: http://www.iana.org/cgi-bin/mediatypes.pl\r\n[10]: http://www.ietf.org/rfc/rfc3986.txt\r\n[11]: /resourcetypes  ","google":"UA-48277211-1","note":"Don't delete this file! It's used internally to help with page regeneration."}